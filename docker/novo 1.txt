
docker compose up --build
docker compose -f docker-compose.rabbit.yml up -d
docker compose -f docker-compose.rabbit.yml up -d

Get-ChildItem -Recurse -Include bin,obj | Remove-Item -Recurse -Force -ErrorAction SilentlyContinue

--===============================
Outbox + RabbitMQ garantindo entrega exatamente-uma-vez (idempotência distribuída) — isso transforma 
sua API em sistema tolerante a falhas reais.
--===============================


using GBastos.Casa_dos_Farelos.Domain.Common;

namespace GBastos.Casa_dos_Farelos.Domain.Outbox;

/// <summary>
/// Mensagem de Outbox para envio assíncrono de eventos de domínio.
/// </summary>
public sealed class OutboxMessage : Entity
{
    public string Type { get; private set; } = null!;
    public string Payload { get; private set; } = null!;
    public DateTime OccurredOnUtc { get; private set; }
    public DateTime? ProcessedOn { get; private set; }
    public int Attempts { get; private set; }

    private OutboxMessage() { } // EF Core

    public OutboxMessage(string type, string payload)
    {
        Id = Guid.NewGuid();
        Type = type ?? throw new ArgumentNullException(nameof(type));
        Payload = payload ?? throw new ArgumentNullException(nameof(payload));
        OccurredOnUtc = DateTime.UtcNow;
        Attempts = 0;
    }

    /// <summary>
    /// Marca a mensagem como processada.
    /// </summary>
    public void MarkAsProcessed()
    {
        ProcessedOn = DateTime.UtcNow;
        Attempts++;
    }

    public bool IsProcessed => ProcessedOn.HasValue;
}

'''
‘OutboxMessage’ não contém uma definição para "OccurredOn" e não foi possível encontrar nenhum método de extensão "OccurredOn" que aceite um primeiro argumento do tipo ‘OutboxMessage’ (você está se esquecendo de usar uma diretiva ou uma referência de assembly?)
'''